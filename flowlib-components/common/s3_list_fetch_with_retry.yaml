component_name: S3 List Fetch With Retry

defaults:
  s3_min_object_age: 5m
  s3_prefix: /

required_vars:
- s3_bucket
- s3_region

process_group:
- name: list-s3
  type: processor
  config:
    package_id: org.apache.nifi.processors.aws.s3.ListS3
    properties:
      Bucket: $(s3_bucket)
      Region: $(s3_region)
      prefix: $(s3_prefix)
      min-age: $(s3_min_object_age)
  connections:
  - name: fetch-s3
    relationships: ['success']

- name: fetch-s3
  type: processor
  config:
    package_id: org.apache.nifi.processors.aws.s3.FetchS3Object
    properties:
      Bucket: $(s3_bucket)
      Region: $(s3_region)
  connections:
  - name: fetch-s3
    relationships: ['failure']
  - name: output
    relationships: ['success']

- name: output
  type: output_port
