name: Demo Flow
version: 1.0

# TODO: Allow Common Default properties for processors?
#   How would these be passed down and merged with child components?
# processor_defaults:
#   **nipyapi.nifi.models.processor_config_dto.processorConfigDTO

# TODO: Allow Common Defaults for connections?
#   How would these be passed down and merged with child components?
# connection_defaults:
#   **nipyapi.nifi.models.connection_dto.ConnectionDTO

# TODO: Add top-level vars that can be used globally?

# TODO: Should controllers be global or at the component level?
# similar to required_vars, we could have required_controllers

# TODO: Add support for Remoteprocess_group Elements

# TODO: Add config for terminating unspecified relationships automatically?
#   How should we handle overriding which relationships to auto-terminate inside a component with multiple processors?
# default_auto_terminate_relationships: False

# TODO: Config for removing OutputPorts which have no downstream connections?
# A `is_terminal: bool` attribute for process_group elements so that we can skip creation of OutputPorts?
# e.g. some components will define output ports which might be unused

# TODO: Add VariableRegistry vars for Flow and for Components

controllers: []

canvas:
# TODO: Test a downstream connection to a component with no inputs
# TODO: Test input/output port on root canvas (currently raises exception)

- name: listfetch-east
  type: process_group
  component_ref: common/s3_list_fetch_with_retry.yaml
  vars:
    s3_bucket: stackspace-us-east-1
    s3_region: us-east-1
    s3_prefix: /abc/def/
  connections:
  - name: debug
    from_port: output
    to_port: input

- name: listfetch-west
  type: process_group
  component_ref: common/s3_list_fetch_with_retry.yaml
  vars:
    s3_bucket: stackspace-us-west-1
    s3_region: us-west-1
  connections:
  - name: debug
    from_port: output
    to_port: input

- name: debug
  type: process_group
  component_ref: common/debug.yaml
  connections:
  - name: port-tester
    from_port: output
    to_port: success-input

- name: port-tester
  type: process_group
  component_ref: common/port_test.yaml
  connections:
  - name: log-attribute
    from_port: success-output
  - name: log-attribute
    from_port: failure-output

- name: log-attribute
  type: processor
  config:
    package_id: org.apache.nifi.processors.standard.LogAttribute
    properties:
      Log Level: info
      Log Payload: False
  connections:
  - name: port-tester-two
    relationships: ['success']
    to_port: success-input

- name: port-tester-two
  type: process_group
  component_ref: common/port_test.yaml
